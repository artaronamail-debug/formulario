<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Galer√≠a de Im√°genes - Dante Propiedades</title>
    <link rel="stylesheet" href="gallery.css">
</head>
<body>
    <!-- HEADER CON LOGO CORPORATIVO -->
    <header class="gallery-header">
        <h1>
            <div class="company-logo">
                <img src="llave.png" alt="Dante Propiedades Logo" onerror="this.style.display='none'">
            </div>
            GALER√çA DE IM√ÅGENES
        </h1>
        <div class="header-subtitle">Descubre nuestras propiedades con im√°genes de alta calidad</div>
    </header>

    <!-- BOT√ìN DE REGRESO AL SITIO PRINCIPAL -->
    <div style="text-align: center; padding: 20px; background: rgba(255,255,255,0.9); margin: 0 15px 20px; border-radius: 10px;">
        <a href="index.html" style="
            display: inline-flex; 
            align-items: center; 
            gap: 10px; 
            padding: 12px 25px; 
            background: linear-gradient(135deg, #232deb 0%, #1a1db4 100%); 
            color: white; 
            text-decoration: none; 
            border-radius: 8px; 
            font-weight: 600; 
            font-size: 14px; 
            transition: all 0.3s ease; 
            box-shadow: 0 4px 15px rgba(35, 45, 235, 0.3);
        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(35, 45, 235, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(35, 45, 235, 0.3)'">
            <span style="font-size: 16px;">üè†</span>
            <span>Volver al Sitio Principal</span>
        </a>
    </div>

    <!-- ESTAD√çSTICAS -->
    <div class="gallery-stats">
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-number" id="total-images">24</div>
                <div class="stat-label">Im√°genes</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">12</div>
                <div class="stat-label">Propiedades</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">6</div>
                <div class="stat-label">Barrios</div>
            </div>
        </div>
    </div>

    <!-- FILTROS -->
    <div class="gallery-filters">
        <button class="filter-btn active" data-filter="all">Todas</button>
        <button class="filter-btn" data-filter="venta">Venta</button>
        <button class="filter-btn" data-filter="alquiler">Alquiler</button>
        <button class="filter-btn" data-filter="alquiler temporal">Temporal</button>
        <button class="filter-btn" data-filter="departamento">Departamentos</button>
        <button class="filter-btn" data-filter="casa">Casas</button>
    </div>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="gallery-container">
        <div class="gallery-grid" id="gallery-grid">
            <div class="loading">üîÑ Cargando galer√≠a...</div>
        </div>
    </div>

    <!-- MODAL PARA IMAGEN COMPLETA -->
    <div class="image-modal" id="imageModal">
        <div class="modal-content">
            <img class="modal-image" id="modalImage" alt="">
            <button class="modal-close" onclick="closeModal()">√ó</button>
            <button class="modal-nav modal-prev" onclick="navigateModal(-1)">‚Äπ</button>
            <button class="modal-nav modal-next" onclick="navigateModal(1)">‚Ä∫</button>
        </div>
    </div>

    <!-- WHATSAPP FLOTANTE -->
    <a href="https://wa.me/5491125368595?text=Hola,%20me%20interesa%20conocer%20m√°s%20propiedades" 
       class="whatsapp-float" 
       target="_blank" 
       title="Contactar por WhatsApp">
        üí¨
    </a>

    <script>
        // Variables globales
        let currentImageIndex = 0;
        let galleryImages = [];
        let currentFilter = 'all';

        // Funci√≥n para cargar propiedades desde propiedades.json
        async function loadGallery() {
            try {
                const response = await fetch('propiedades.json');
                const properties = await response.json();
                
                // Procesar propiedades y crear elementos de galer√≠a
                const processedProperties = [];
                
                properties.forEach(property => {
                    if (property.multimedia && property.multimedia.imagenes) {
                        property.multimedia.imagenes.forEach((imagen, index) => {
                            processedProperties.push({
                                ...property,
                                imageSrc: imagen,
                                imageIndex: index,
                                imageId: `${property.id_temporal}_${index}`
                            });
                        });
                    }
                });

                galleryImages = processedProperties;
                renderGallery();
                updateStats();
                
            } catch (error) {
                console.error('Error cargando galer√≠a:', error);
                document.getElementById('gallery-grid').innerHTML = `
                    <div class="error">
                        <p>‚ùå Error cargando la galer√≠a</p>
                        <p>Por favor, intenta actualizar la p√°gina</p>
                    </div>
                `;
            }
        }

        // Funci√≥n para renderizar la galer√≠a
        function renderGallery() {
            const grid = document.getElementById('gallery-grid');
            
            let filteredImages = galleryImages;
            
            // Aplicar filtro
            if (currentFilter !== 'all') {
                filteredImages = galleryImages.filter(img => {
                    if (currentFilter === 'venta') return img.operacion === 'venta';
                    if (currentFilter === 'alquiler') return img.operacion === 'alquiler';
                    if (currentFilter === 'alquiler temporal') return img.operacion === 'alquiler temporal';
                    if (currentFilter === 'departamento') return img.tipo === 'departamento';
                    if (currentFilter === 'casa') return img.tipo === 'casa';
                    return true;
                });
            }

            if (filteredImages.length === 0) {
                grid.innerHTML = `
                    <div class="no-results">
                        <p>No se encontraron im√°genes con el filtro seleccionado</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filteredImages.map((property, index) => `
                <div class="gallery-item" onclick="openModal(${galleryImages.indexOf(property)})">
                    <img src="${property.imageSrc}" 
                         alt="${property.titulo || 'Propiedad Dante'}" 
                         class="gallery-image"
                         loading="lazy">
                    <div class="image-overlay">
                        <div class="image-title">${property.titulo || 'Propiedad Dante'}</div>
                        <div class="image-location">üìç ${property.barrio || 'Capital Federal'}</div>
                        ${property.precio ? `<div class="image-price">${formatPrice(property.precio)}</div>` : ''}
                        <div class="image-actions">
                            <button class="action-btn btn-info" onclick="event.stopPropagation(); showPropertyDetails('${property.id_temporal}')">
                                üìã Detalles
                            </button>
                            <a class="action-btn btn-contact" href="https://wa.me/5491125368595?text=Hola,%20me%20interesa%20la%20propiedad%20${property.titulo || property.id_temporal}" target="_blank">
                                üìû Contactar
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Funci√≥n para abrir modal
        function openModal(index) {
            currentImageIndex = index;
            const property = galleryImages[index];
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            
            modalImage.src = property.imageSrc;
            modalImage.alt = property.titulo || 'Propiedad Dante';
            modal.style.display = 'flex';
            
            // Ocultar navegaci√≥n si es la √∫nica imagen
            const prevBtn = document.querySelector('.modal-prev');
            const nextBtn = document.querySelector('.modal-next');
            
            if (galleryImages.length <= 1) {
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'none';
            } else {
                prevBtn.style.display = 'flex';
                nextBtn.style.display = 'flex';
            }
        }

        // Funci√≥n para cerrar modal
        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
        }

        // Funci√≥n para navegar en el modal
        function navigateModal(direction) {
            const newIndex = currentImageIndex + direction;
            
            if (newIndex < 0) {
                currentImageIndex = galleryImages.length - 1;
            } else if (newIndex >= galleryImages.length) {
                currentImageIndex = 0;
            } else {
                currentImageIndex = newIndex;
            }
            
            const property = galleryImages[currentImageIndex];
            document.getElementById('modalImage').src = property.imageSrc;
            document.getElementById('modalImage').alt = property.titulo || 'Propiedad Dante';
        }

        // Funci√≥n para mostrar detalles de propiedad
        function showPropertyDetails(propertyId) {
            // Abrir la p√°gina principal con el filtro aplicado
            window.open(`index.html?property=${propertyId}`, '_blank');
        }

        // Funci√≥n para actualizar estad√≠sticas
        function updateStats() {
            document.getElementById('total-images').textContent = galleryImages.length;
        }

        // Funci√≥n para formatear precios
        function formatPrice(price) {
            return new Intl.NumberFormat('es-AR', {
                style: 'currency',
                currency: 'ARS',
                minimumFractionDigits: 0
            }).format(price);
        }

        // Funci√≥n para filtrar
        function setupFilters() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            
            filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    renderGallery();
                });
            });
        }

        // Cerrar modal con ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            } else if (e.key === 'ArrowLeft') {
                navigateModal(-1);
            } else if (e.key === 'ArrowRight') {
                navigateModal(1);
            }
        });

        // Cerrar modal al hacer clic fuera de la imagen
        document.getElementById('imageModal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) {
                closeModal();
            }
        });

        // Inicializar galer√≠a
        document.addEventListener('DOMContentLoaded', () => {
            setupFilters();
            loadGallery();
        });
    </script>
</body>
</html>